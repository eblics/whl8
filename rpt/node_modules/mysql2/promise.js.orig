var core = require('./index.js');

function createConnection(opts) {
<<<<<<< HEAD
  var coreConnection = core.createConnection(opts);
  var Promise = opts.Promise || global.Promise || require('es6-promise')
  return new Promise(function(resolve, reject) {
    coreConnection.once('connect', function(connectParams) {
      resolve(new PromiseConnection(coreConnection, Promise));
=======
  console.log('here');
  var coreConnection = core.createConnection(opts);
  return new Promise(function(resolve, reject) {
    coreConnection.once('connect', function(connectParams) {
      resolve(new PromiseConnection(coreConnection));
>>>>>>> 8dfad9dcbc7fe5189a782a924837dd2c0c781f44
    });
    coreConnection.once('error', reject);
  });
}

<<<<<<< HEAD
function PromiseConnection(connection, promiseImpl) {
  this.connection = connection;
  this.Promise = promiseImpl;
}

PromiseConnection.prototype.release = function() {
  this.connection.release();
};

PromiseConnection.prototype.query = function(sql, values) {
  var c = this.connection;
  return new this.Promise(function(resolve, reject) {
=======
function PromiseConnection(connection) {
  this.connection = connection;
}

PromiseConnection.prototype.query = function(sql, values) {
  var c = this.connection;
  return new Promise(function(resolve, reject) {
>>>>>>> 8dfad9dcbc7fe5189a782a924837dd2c0c781f44
    c.query(sql, values, function(err, rows, fields) {
      if (err)
        reject(err);
      else
        resolve([rows, fields]);
    });
  });
};

PromiseConnection.prototype.execute = function(query, params) {
  var c = this.connection;
<<<<<<< HEAD
  return new this.Promise(function(resolve, reject) {
=======
  return new Promise(function(resolve, reject) {
>>>>>>> 8dfad9dcbc7fe5189a782a924837dd2c0c781f44
    c.execute(query, params, function(err, rows, fields) {
      if (err)
        reject(err);
      else
        resolve([rows, fields]);
    });
  });
};

PromiseConnection.prototype.end = function() {
  var c = this.connection;
<<<<<<< HEAD
  return new this.Promise(function(resolve, reject) {
=======
  return new Promise(function(resolve, reject) {
>>>>>>> 8dfad9dcbc7fe5189a782a924837dd2c0c781f44
    c.end(function() {
      resolve();
    });
  });
};

<<<<<<< HEAD
function createPool(opts) {
  var corePool = core.createPool(opts);
  var Promise = opts.Promise || global.Promise || require('es6-promise');

  var promisePool = {
    getConnection: function() {
      return new Promise(function(resolve, reject) {
        corePool.getConnection(function(err, coreConnection) {
          if (err)
            reject(err);
          else
            resolve(new PromiseConnection(coreConnection, Promise));
        });
      });
    },

    query: function(sql, args) {
      return new Promise(function(resolve, reject) {
        corePool.query(sql, args, function(err, rows, fields) {
          if (err)
            reject(err);
          else
            resolve([rows, fields]);
        });
      });
    },

    execute: function(sql, args) {
      return new Promise(function(resolve, reject) {
        corePool.execute(sql, args, function(err, rows, fields) {
          if (err)
            reject(err);
          else
            resolve([rows, fields]);
        });
      });
    },

    end: function() {
      return new Promise(function(resolve, reject) {
        corePool.end(function(err) {
          if (err)
            reject(err);
          else
            resolve();          
        })
      });
    }
  };

  return promisePool;
}

module.exports.createConnection = createConnection;
module.exports.createPool = createPool;
=======
module.exports.createConnection = createConnection;
>>>>>>> 8dfad9dcbc7fe5189a782a924837dd2c0c781f44
