/*! jquery.eraser-0.5.1.min */
(function(b){var a={init:function(c){return this.each(function(){var f=b(this),e=f.data("eraser");if(!e){var d=function(){var k=b("<canvas/>"),i=k.get(0),y=i.getContext("2d"),A=window.devicePixelRatio||1,m=y.webkitBackingStorePixelRatio||y.mozBackingStorePixelRatio||y.msBackingStorePixelRatio||y.oBackingStorePixelRatio||y.backingStorePixelRatio||1,s=A/m,v=f.width(),z=f.height(),x=v*s,p=z*s,j=f.offset(),o=((c&&c.size)?c.size:40)*s,h=(c&&c.completeRatio)?c.completeRatio:0.7,g=(c&&c.completeFunction)?c.completeFunction:null,r=(c&&c.progressFunction)?c.progressFunction:null,q=f.css("z-index")=="auto"?1:f.css("z-index"),w=[],B=Math.floor(x/o),t=B*Math.floor(p/o),u=t,l=f[0];f.after(k);i.id=l.id;i.className=l.className;i.width=x;i.height=p;i.style.width=v.toString()+"px";i.style.height=z.toString()+"px";y.drawImage(l,0,0,x,p);f.remove();y.globalCompositeOperation="destination-out";y.strokeStyle="rgba(255,0,0,255)";y.lineWidth=o;y.lineCap="round";k.bind("mousedown.eraser",a.mouseDown);k.bind("touchstart.eraser",a.touchStart);k.bind("touchmove.eraser",a.touchMove);k.bind("touchend.eraser",a.touchEnd);while(u--){w.push(1)}e={posX:j.left,posY:j.top,touchDown:false,touchID:-999,touchX:0,touchY:0,ptouchX:0,ptouchY:0,canvas:k,ctx:y,w:x,h:p,scaleRatio:s,source:l,size:o,parts:w,colParts:B,numParts:t,ratio:0,complete:false,completeRatio:h,completeFunction:g,progressFunction:r,zIndex:q};k.data("eraser",e);b(window).resize(function(){var n=k.offset();e.posX=n.left;e.posY=n.top})};if(this.complete&&this.naturalWidth>0){d()}else{f.load(d)}}})},touchStart:function(f){var h=b(this),g=h.data("eraser");if(!g.touchDown){var e=f.originalEvent.changedTouches[0],d=e.pageX-g.posX,c=e.pageY-g.posY;d*=g.scaleRatio;c*=g.scaleRatio;a.evaluatePoint(g,d,c);g.touchDown=true;g.touchID=e.identifier;g.touchX=d;g.touchY=c;f.preventDefault()}},touchMove:function(f){var h=b(this),g=h.data("eraser");if(g.touchDown){var e=f.originalEvent.changedTouches,i=e.length;while(i--){if(e[i].identifier==g.touchID){var d=e[i].pageX-g.posX,c=e[i].pageY-g.posY;d*=g.scaleRatio;c*=g.scaleRatio;a.evaluatePoint(g,d,c);g.ctx.beginPath();g.ctx.moveTo(g.touchX,g.touchY);g.touchX=d;g.touchY=c;g.ctx.lineTo(g.touchX,g.touchY);g.ctx.stroke();h.css({"z-index":h.css("z-index")==g.zIndex?parseInt(g.zIndex)+1:g.zIndex});f.preventDefault();break}}}},touchEnd:function(d){var f=b(this),e=f.data("eraser");if(e.touchDown){var c=d.originalEvent.changedTouches,g=c.length;while(g--){if(c[g].identifier==e.touchID){e.touchDown=false;d.preventDefault();break}}}},evaluatePoint:function(e,d,c){var f=Math.floor(d/e.size)+Math.floor(c/e.size)*e.colParts;if(f>=0&&f<e.numParts){e.ratio+=e.parts[f];e.parts[f]=0;if(!e.complete){f=e.ratio/e.numParts;if(f>=e.completeRatio){e.complete=true;if(e.completeFunction!=null){e.completeFunction()}}else{if(e.progressFunction!=null){e.progressFunction(f)}}}}},mouseDown:function(e){var g=b(this),f=g.data("eraser"),d=e.pageX-f.posX,c=e.pageY-f.posY;d*=f.scaleRatio;c*=f.scaleRatio;a.evaluatePoint(f,d,c);f.touchDown=true;f.touchX=d;f.touchY=c;f.ctx.beginPath();f.ctx.moveTo(f.touchX-1,f.touchY);f.ctx.lineTo(f.touchX,f.touchY);f.ctx.stroke();g.bind("mousemove.eraser",a.mouseMove);b(document).bind("mouseup.eraser",f,a.mouseUp);e.preventDefault()},mouseMove:function(e){var g=b(this),f=g.data("eraser"),d=e.pageX-f.posX,c=e.pageY-f.posY;d*=f.scaleRatio;c*=f.scaleRatio;a.evaluatePoint(f,d,c);f.ctx.beginPath();f.ctx.moveTo(f.touchX,f.touchY);f.touchX=d;f.touchY=c;f.ctx.lineTo(f.touchX,f.touchY);f.ctx.stroke();g.css({"z-index":g.css("z-index")==f.zIndex?parseInt(f.zIndex)+1:f.zIndex});e.preventDefault()},mouseUp:function(c){var d=c.data,e=d.canvas;d.touchDown=false;e.unbind("mousemove.eraser");b(document).unbind("mouseup.eraser");c.preventDefault()},clear:function(){var d=b(this),c=d.data("eraser");if(c){c.ctx.clearRect(0,0,c.w,c.h);var e=c.numParts;while(e--){c.parts[e]=0}c.ratio=c.numParts;c.complete=true;if(c.completeFunction!=null){c.completeFunction()}}},size:function(d){var e=b(this),c=e.data("eraser");if(c&&d){c.size=d;c.ctx.lineWidth=d}},reset:function(){var d=b(this),c=d.data("eraser");if(c){c.ctx.globalCompositeOperation="source-over";c.ctx.drawImage(c.source,0,0,c.w,c.h);c.ctx.globalCompositeOperation="destination-out";var e=c.numParts;while(e--){c.parts[e]=1}c.ratio=0;c.complete=false;c.touchDown=false}},progress:function(){var d=b(this),c=d.data("eraser");if(c){return c.ratio/c.numParts}return 0}};b.fn.eraser=function(c){if(a[c]){return a[c].apply(this,Array.prototype.slice.call(arguments,1))}else{if(typeof c==="object"||!c){return a.init.apply(this,arguments)}else{b.error("Method "+c+" does not yet exist on jQuery.eraser")}}}})(jQuery);